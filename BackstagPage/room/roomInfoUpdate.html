<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>TRPG-MEMBER INFO</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="stylesheet" href="../../resource/css/xadmin/font.css">
    <link rel="stylesheet" href="../../resource/css/xadmin/xadmin.css">
    <script src="../../resource/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../resource/lib/xadmin.js"></script>
    <script type="text/javascript" src="../../resource/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../../resource/js/utils/baseUtils.js"></script>
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="x-nav">

			<span class="layui-breadcrumb">
            <a href="">房间信息</a>
            
          </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
</div>

<div class="layui-container">
    <div class="layui-card">
        <div class="layui-card-header">房间基础信息</div>
        <div class="layui-card-body">
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label">房间ID</label>
                    <div class="layui-input-block">
                        <input name="id" disabled="disabled" type="text" required lay-verify="required"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">创建时间</label>
                    <div class="layui-input-block">
                        <input name='createTime' disabled="disabled" type="text" required lay-verify="required"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">房间名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="name" required lay-verify="required" placeholder="请输入房间名称"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">房间密码</label>
                    <div class="layui-input-block">
                        <input type="text" name="password" required lay-verify="" placeholder="" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">玩家数</label>
                    <div class="layui-input-block">
                        <input type="number" name="player" required lay-verify="number" placeholder=""
                               autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">房间骰子面数</label>

                    <div class="layui-input-block">
                        <input type="number" name="diceFace" required="" lay-verify="required" class="layui-input"
                               value="100">

                        <div class="layui-form-mid layui-word-aux">
                            <p>影响骰子丢出的最大数值效果，类似于默认为100面骰=1D100</p>
                            <p>ps:骰子面数不能过大</p>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">房规</label>
                    <div class="layui-input-block">
                        <input type="number" name="houseRules" required="" lay-verify="required" class="layui-input"
                               value="1">

                        <div class="layui-form-mid layui-word-aux">
                            <p>房规影响骰子丢出的数值成功类型，默认为1，那么大成功规定为 1 大失败为 100.</p>
                            <p>如果数值为0, 那么没有大成功和大失败.</p>
                            <p>如果数值为5,那么大成功为1-5 大失败为96-100.以此类推.</p>
                            <p>ps:房规不能超过50</p>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">是否显示在公开列表</label>
                    <div class="layui-input-block">
                        <input type="radio" name="display" value="0" title="隐藏">
                        <input type="radio" name="display" value="1" title="显示">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">新成员查看历史消息</label>
                    <div class="layui-input-block">
                        <input type="radio" name="isFindRecord" value="0" title="允许" checked>
                        <input type="radio" name="isFindRecord" value="1" title="禁止">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">房间种类</label>
                    <div class="layui-input-block">
                        <input type="radio" name="type" value="0" title="a模式">
                        <input type="radio" name="type" value="1" title="b模式">
                        <input type="radio" name="type" value="2" title="c模式">
                        <div class="layui-form-mid layui-word-aux">
                            <p>房间种类会影响 房间内的玩家们可以看到对方的数据信息程度。</p>
                            <p>a模式:所有人可以看到对方的生命 等一些公开 属性 (例如 HP MP AP SAN)</p>
                            <p>b模式:所有人看不到别人的任何信息，除了名字和头像。</p>
                            <p>c模式:所有人都可以互相的看到对方的卡所有信息</p>
                        </div>
                    </div>

                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">房间图标</label>
                    <div class="layui-input-block">
                        <a onclick="xadmin.open('upload','../upload/resourceUpload.html','','');setTextInputName('ioc');"
                           class="layui-btn">上传图片</a>
                        <input onchange="changeImgSrc(this,'ioc')" name="ioc" placeholder="需要输入正确的URL" lay-verify=''
                               class="layui-input"/>
                        <img style="max-width: 150px;max-height: 150px;" name="ioc" src=""/>
                    </div>
                </div>


                <div class="layui-form-item">
                    <label class="layui-form-label">房间介绍</label>
                    <div class="layui-input-block">
                        <a onclick="xadmin.open('upload','../upload/resourceUpload.html','','');setTextInputName('introduce');"
                           class="layui-btn">上传图片</a>
                        <input onchange="changeImgSrc(this,'introduce')" name="introduce" placeholder="需要输入正确的URL"
                               lay-verify='' class="layui-input"/>

                        <img width="100%" name="introduce" src=""/>
                        <p>房间介绍采用图片的形式，主要方便用户制作令人眼花的图片介绍风格。</p>
                        <p>在一定程度上方便玩家们，感受到模组的风格类型。</p>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="roomAttirubteUpdate">提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>

            <button onclick="deleteRoom()" style="width: 100%;" id="deleteButton" class="layui-btn-danger layui-btn ">
                删除房间
            </button>

        </div>
    </div>

</div>

</body>

<script type="text/javascript" src="../../resource/js/iframe/constant.js"></script>

<script>
    let findRoomId;
    $(location).ready(function () {
        findRoomId = window.location.search;
        loadRoomInfo();
    });

    function deleteRoom() {
        layer.confirm('是否确定删除该房间？', {
            btn: ['确定', '取消']
        }, function () {

            $.ajax({
                type: "delete",
                url: REQUESTHEAD + "/deleteRoom?roomId=" + findRoomId.substring(8),
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (result) {
                    layer.msg(result.message);
                    setTimeout(function () {
                        xadmin.father_reload();
                        xadmin.close();
                    }, 1500);
                }
            });

        }, function () {

        });

    }

    layui.use('form', function () {
        let form = layui.form;

        //监听提交
        form.on('submit(roomAttirubteUpdate)', function (data) {
            $.ajax({
                type: "put",
                url: REQUESTHEAD + "/updateRoomInfo" + findRoomId,
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                data: JSON.stringify(data.field),
                dataType: 'json',
                contentType: "application/json;charset=UTF-8",
                success: function (result) {
                    layer.msg(result.message);
                    setTimeout(function () {
                        xadmin.father_reload();
                        xadmin.close();
                    }, 1500);
                }
            });
            return false;
        });
    });

    function loadRoomInfo() {
        let roomId = findRoomId.substring(8);
        let roomInfoList = parent.RoomInfoData;
        let data = roomInfoList[roomId];
        loadDataToInputBox(data);

    }


    let loadDataToInputBox = function (data) {
        $.each(data, function (key, value) {
            let control = $("input[name='" + key + "']");
            if (control.attr("type") === "radio") {
                $.each(control, function (index, temp) {
                    if (parseInt($(temp).attr("value")) === parseInt(value)) {
                        $(temp).attr("checked", "checked");
                    }
                });
            } else {
                control.val(value);
            }
            $("img[name='" + key + "']").attr("src", value);

        });
        layui.use('form', function () {
            let form = layui.form;
            form.render();
        });
    }

</script>

</html>