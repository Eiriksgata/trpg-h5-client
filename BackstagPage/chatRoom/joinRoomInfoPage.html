<!DOCTYPE html>
<html class="x-admin-sm">

	<head>
		<meta charset="UTF-8">
		<title>ROOM LIST</title>
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=1,target-densitydpi=low-dpi" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="stylesheet" href="../resource/css/font.css">
		<link rel="stylesheet" href="../resource/css/xadmin.css">
		<!-- <link rel="stylesheet" href="./css/theme5.css"> -->
		<script src="../resource/lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../resource/lib/jquery.min.js"></script>
		<script type="text/javascript" src="../resource/lib/xadmin.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<!--<script type="text/javascript" src="../js/index.js"></script>-->
		<style type="text/css">
			.roleCard {
				background-color: white;
				height: 135px;
				max-width: 350px;
			}
		</style>
	</head>

	<body>
		<div class="x-nav">
			<a class="layui-btn" href="../index.html">返回首页</a>
			<span class="layui-breadcrumb">
            
          </span>
			<a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
				<i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
		</div>

		<div class="layui-fluid">

			<div class="">
				<button style="max-width: 300px;" onclick="loadJoinRoomList()" class="layui-btn">查看已加入的房间列表</button>
				<div style="max-width: 300px;">
					<input type="number" name="searchRoomId" placeholder='查询房间ID' style="float: left; width: 85%;" class="layui-input" />
					<button onclick="searchRoomId()" style="width: 15%; float: none;" class="layui-btn">搜索</button>
				</div>

				<!--<div id="roomListView">
					<div v-for="todo in data" class=" layui-col-xs12 layui-col-sm6 layui-col-md4" style="margin-top: 20px;">
						<div v-if="todo.introduce" class="roleCard " style="box-shadow: darkgrey 1px 1px 20px 1px;border: 3px #f2f2f2 solid;">
							<div style="width:135px;height:135px;float: left;box-shadow: darkgrey 1px 1px 10px 1px ;//边框阴影 ">
								<img width="135 " height="135 " v-bind:src="todo.ioc" />
							</div>
							<div style="max-width:200px;position:absolute;left: 160px;top: 10px; ">
								<h2 style="margin-bottom: 5px;">{{todo.roomName}}</h2>
								<h3 style="margin-bottom: 5px;">房间ID:{{todo.roomId}}</h3>
								<h3 style="margin-bottom: 5px;">人数上限:{{todo.player}}</h3>
								<h3 style="margin-bottom: 5px;">创建人:<a style="color: blue;" v-bind:onclick="'openMemberInfo('+todo.createUserId+')'">[点击查看]</a></h3>
								<a v-bind:href="'chatRoom.html?roomId='+todo.roomId" class="layui-btn">加入房间</a>
								<a v-if="todo.introduce" v-bind:onclick="'openRoomDescribe(\''+ todo.introduce +'\')'" class="layui-btn">介绍</a>
							</div>
						</div>
					</div>
				</div>-->
				<table id="roomList"></table>
			</div>

		</div>

		<div class="layui-col-xs12 layui-col-sm12 layui-col-md12" style="text-align: center;color: gray;">
			<div>点击房间名称可以查看房间的图片介绍，如果房主没有设置，那么就没有介绍</div>
			<div>点击创建人ID 可以查看创建人的相关信息</div>
		</div>

	</body>

	<!--<script type="text/html" id="roomInfoBox">

		<div class=" layui-col-xs12 layui-col-sm6 layui-col-md4" style="margin-top: 20px; ">
			<div class="roleCard " onclick="selectRoleCard(this,{{d.id}});" style="box-shadow: darkgrey 1px 1px 20px 1px;border: 3px #f2f2f2 solid;">

				<div style="width:135px;height:135px;float: left;box-shadow: darkgrey 1px 1px 10px 1px ;//边框阴影 ">
					<img width="135 " height="135 " src="{{d.img}}" />
				</div>

				<div style="max-width:200px;position:absolute;left: 160px;top: 10px; ">
					<h2 style="margin-bottom: 5px;">{{d.roomName}}</h2>
					<h3 style="margin-bottom: 5px;">房间ID:{{d.roomId}}</h3>
					<h3 style="margin-bottom: 5px;">人数上限:{{d.player}}</h3>
					<h3 style="margin-bottom: 5px;">创建人:<a style="color: blue;" onclick="xadmin.open('会员信息','../member/findMemberInfo.html?memberId={{d.createUserId}}')">[点击查看]</a></h3>
					<a href="chatRoom.html?roomId={{d.roomId}}" class="layui-btn">加入房间</a>
				</div>
			</div>
		</div>

	</script>-->

	<script type="text/html" id="memberInfo">
		<a onclick="xadmin.open('会员信息','../member/findMemberInfo.html?memberId={{d.createUserId}}')">{{d.createUserId}}</a>
	</script>

	<script type="text/html" id="joinChatRoom">
		<a href="chatRoom.html?roomId={{d.roomId}}">加入房间</a>
		<!--<a onclick="xadmin.open('{{d.roomId}}','chatRoom.html?roomId={{d.roomId}}','','',true)">加入房间</a>-->
	</script>

	<script type="text/html" id="lookRoomImg">
		<a onclick="xadmin.open('{{d.roomName}}','roomAttributeImg.html?img={{d.introduce}}')">{{d.roomName}}</a>
	</script>

	<script>
		//这个不是写在首页，写在子页面（子页面才能返回，写在首页点击返回就是退出）
		//不用引入mui.js，都是h5方法
		document.addEventListener('plusready', function() {
			var webview = plus.webview.currentWebview();
			plus.key.addEventListener('backbutton', function() {
				webview.canBack(function(e) {
					if(e.canBack) {
						webview.back();
					} else {
						webview.close(); //hide,quit
						//plus.runtime.quit();
					}
				})
			});
		});

		$(location).ready(function() {
			loadAllRoomList();
		});

		function openMemberInfo(memberId) {
			xadmin.open("会员信息", "../member/findMemberInfo.html?memberId=" + memberId);
		}

		function openRoomDescribe(url) {
			xadmin.open("房间介绍", "roomAttributeImg.html?url=" + url);
		}

		function searchRoomId() {
			$.ajax({
				type: "get",
				url: "http://localhost/searchRoomId?roomId=" + $("input[name=searchRoomId]").val(),
				xhrFields: {
					withCredentials: true
				},
				crossDomain: true,
				success: function(data) {

					loadTableRendering(data.data);
					if(data.code == 1) {
						layer.msg(data.message);
					}
				}
			});

		}

		function loadJoinRoomList() {

			$.ajax({
				type: "get",
				url: "http://localhost/findJoinRoomList",
				xhrFields: {
					withCredentials: true
				},
				crossDomain: true,
				success: function(data) {
					loadTableRendering(data.data);
					if(data.code == 1) {
						layer.msg(data.message);
					}
				}

			});
		}

		function loadTableRendering(data) {
			var roomList = new Vue({
				el: '#roomListView',
				data: data
			});
			layui.use('table', function() {
				var table = layui.table;
				table.render({
					elem: '#roomList',
					height: 400,
					page: true,
					data: data.data,
					cols: [
						[{
							field: 'roomId',
							title: '房间ID',
							width: 80,
							sort: true,
						}, {
							field: 'roomName',
							title: '房间名',
							width: 150,
							templet: '#lookRoomImg'
						}, {
							field: 'player',
							title: '玩家数',
							width: 80,
							sort: true
						}, {
							field: 'createUserId',
							title: '创建人ID',
							width: 80,
							templet: '#memberInfo'
						}, {
							title: '操作',
							width: 100,
							templet: '#joinChatRoom',
							fixed: 'right'
						}]
					]
				});

			});

		}

		function loadAllRoomList() {
			$.ajax({
				type: "get",
				url: "http://localhost/findRoomList",
				xhrFields: {
					withCredentials: true
				},
				crossDomain: true,
				success: function(data) {
					loadTableRendering(data);
				}
			});

		}
	</script>

</html>