<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>ROLE CREATE</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="stylesheet" href="../../resource/css/xadmin/font.css">
    <link rel="stylesheet" href="../../resource/css/xadmin/xadmin.css">
    <script src="../../resource/lib/layui/layui.js" charset="utf-8"></script>

    <script type="text/javascript" src="../../resource/lib/xadmin.js"></script>
    <script type="text/javascript" src="../../resource/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../../resource/js/utils/baseUtils.js"></script>
    <script type="text/javascript" src="../../resource/lib/weaponData.js"></script>
    <script type="text/javascript" src="../../resource/js/iframe/constant.js"></script>

    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>
<div class="x-nav">
    <button onclick="importRoleButton()" class="layui-btn">代码导入</button>
    <span class="layui-breadcrumb">
          </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
</div>
<div class="layui-container">

    <form class="layui-form layui-form-pane" style="margin: 10px;">
        <div class="layui-form-mid layui-word-aux">本录入系统不推荐直接在此录入，技能属性等，请使用COC7版规则卡进行详细车卡操作，此页面属于快速录入人物属性</div>
        <div class="layui-form-item">
            <label class="layui-form-label">角色姓名</label>
            <div class="layui-input-block">
                <input type="text" name="name" required lay-verify="required" placeholder="" autocomplete="off"
                       class="layui-input">
            </div>
        </div>


        <div class="layui-form-item">
            <label class="layui-form-label">性别</label>
            <div class="layui-input-block">
                <input id="private" type="radio" name="sex" value="0" title="保密">
                <input id="man" type="radio" name="sex" value="1" title="男">
                <input id="women" type="radio" name="sex" value="2" title="女">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">年龄</label>
            <div class="layui-input-block">
                <input type="number" name="age" required lay-verify="number" placeholder="" autocomplete="off"
                       class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">职业</label>
            <div class="layui-input-block">
                <input type="text" name="occupation" required lay-verify="required" placeholder="请遵循COC7规则卡的人物职业"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">所属时代</label>
            <div class="layui-input-block">
                <input type="text" name="times" required lay-verify="required" placeholder="例如：现代" autocomplete="off"
                       class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">故乡</label>
            <div class="layui-input-block">
                <input type="text" name="hometown" required lay-verify="required" placeholder="指出生地" autocomplete="off"
                       class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">现住地</label>
            <div class="layui-input-block">
                <input type="text" name="residence" required lay-verify="required" placeholder="现在居住的地方"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">角色头像URL</label>
            <div class="layui-input-block">
                <a onclick="xadmin.open('upload','../upload/resourceUpload.html','','');setTextInputName('img');"
                   class="layui-btn">上传图片</a>
                <input onchange="changeImgSrc(this,'img')" name="img" class="layui-input" required
                       lay-verify="url or null"></input>
                <img style="max-width: 150px;max-height: 150px;" name="img" src=""/>
                <div>*需要输入正确的url链接，不然无法通过检验。如果没有则留空。</div>

            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">属性</label>
            <div class="layui-input-block">
                <textarea name="attribute" class="layui-textarea" required lay-verify="required"></textarea>
                <div>按照COC7基础人物卡属性规则快速录入例如:力量70敏捷60会计5(不需要加上.st)</div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">携带物品</label>
            <div class="layui-input-block">
                <textarea name="takeList" class="layui-textarea" required lay-verify="required"></textarea>
                <div class="layui-form-mid layui-word-aux">基本的文字描述，车卡完成转接给KP审核。基础物质系统不提供额外的计算系统。</div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">资产</label>
            <div class="layui-input-block">
                <textarea name="assets" class="layui-textarea" required lay-verify="required"></textarea>
                <div class="layui-form-mid layui-word-aux">角色所拥有的基本资产描述，通常是钱等</div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">人物故事</label>
            <div class="layui-input-block">
                <textarea name="roleStory" class="layui-textarea" required lay-verify="required"></textarea>
                <div class="layui-form-mid layui-word-aux">该内容包含
                    人物基本的信息，包含外貌，所爱之物等，以及详细的家庭背景和人物性格。以及人物的历程等等。开放长度为500。如果字数上限超过，那么请在备注处继续编写，或者用如果需要了解详情，可以找某人。
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">基因备注</label>
            <div class="layui-input-block">
                <textarea name="remarks" class="layui-textarea" required lay-verify="required"></textarea>
                <div class="layui-form-mid layui-word-aux">
                    该内容是作为初始创建附带的，今后无论如何都无法修改的词条。需要慎重书写，一般可以作为描述。这里会在首条生成一段红色的数字签名，可以用来验证创建人的ID。
                </div>
            </div>
        </div>


        <div class="layui-form-item">
            <label class="layui-form-label">武器列表</label>
            <div class="layui-input-block">
                <textarea name="weaponList" class="layui-textarea"></textarea>
                <div class="layui-form-mid layui-word-aux">通过文字描述用来记录角色所拥有的武器，武器的基本属性可以参考下表</div>
            </div>
        </div>

        <button class="layui-btn" style="width: 100%;" lay-submit lay-filter="roleForm">提交</button>

    </form>

    <fieldset class="layui-elem-field" style="margin-top: 10px;">
        <legend>武器参考表</legend>
        <div class="layui-field-box">
            <div class="layui-container text-center layui-word-aux">鼠标停留后会显示详细的武器信息介绍</div>
            <table class="layui-table">
                <colgroup>
                    <col width="150"/>
                    <col width="200"/>
                </colgroup>
                <thead>
                <tr>
                    <th>名称</th>
                    <th>类型</th>
                    <th>技能</th>
                    <th>伤害</th>
                    <th>故障值</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="weaponTableBody">
                <!--ms-for:key in [0,1,2,3,4]-->
                <tr id="tips" title="">
                    <td class="text-left">
                        <input class="layui-input" id="weaponName" value="" type="text">
                    </td>
                    <td class="text-center">
                        <select class="layui-select" id="weaponListSelect" onchange="weaponListSelectChang(this)">
                            <!--ms-for:(index,item) in equipList-->
                            <option selected="selected" value="0">请选择</option>
                            <!--for216425371432-->
                            <option value="1">肉搏</option>
                            <!--for216425371432-->
                            <option value="2">弓</option>
                            <!--for216425371432-->
                            <option value="3">弩</option>
                            <!--for216425371432-->
                            <option value="4">黄铜指虎</option>
                            <!--for216425371432-->
                            <option value="5">长鞭</option>
                            <!--for216425371432-->
                            <option value="6">燃烧的火把</option>
                            <!--for216425371432-->
                            <option value="7">电锯</option>
                            <!--for216425371432-->
                            <option value="8">包皮铁棍(甩棍、护身短棒)</option>
                            <!--for216425371432-->
                            <option value="9">大型棍状物(棒球棍、板球棒、拨火棍等)</option>
                            <!--for216425371432-->
                            <option value="10">小型棍状物(警棍等)</option>
                            <!--for216425371432-->
                            <option value="11">绞具</option>
                            <!--for216425371432-->
                            <option value="12">手斧/镰刀</option>
                            <!--for216425371432-->
                            <option value="13">大型刀具(大砍刀等)</option>
                            <!--for216425371432-->
                            <option value="14">中型刀具(切肉菜刀等)</option>
                            <!--for216425371432-->
                            <option value="15">小型刀具(弹簧折叠刀等)</option>
                            <!--for216425371432-->
                            <option value="16">220v通电导线</option>
                            <!--for216425371432-->
                            <option value="17">催泪瓦斯</option>
                            <!--for216425371432-->
                            <option value="18">双节棍</option>
                            <!--for216425371432-->
                            <option value="19">投石</option>
                            <!--for216425371432-->
                            <option value="20">手里剑</option>
                            <!--for216425371432-->
                            <option value="21">矛、骑士长枪</option>
                            <!--for216425371432-->
                            <option value="22">掷矛</option>
                            <!--for216425371432-->
                            <option value="23">大型剑(马刀)</option>
                            <!--for216425371432-->
                            <option value="24">中型剑(佩剑等)</option>
                            <!--for216425371432-->
                            <option value="25">轻剑(击剑、剑杖等)</option>
                            <!--for216425371432-->
                            <option value="26">电棍、电击枪(接触)</option>
                            <!--for216425371432-->
                            <option value="27">电击枪(远程)</option>
                            <!--for216425371432-->
                            <option value="28">利刃回旋镖</option>
                            <!--for216425371432-->
                            <option value="29">伐木斧</option>
                            <!--for216425371432-->
                            <option value="30">遂发枪</option>
                            <!--for216425371432-->
                            <option value="31">.22 短口自动手枪</option>
                            <!--for216425371432-->
                            <option value="32">.25 短口手枪 (单管)</option>
                            <!--for216425371432-->
                            <option value="33">.32 or 7.65mm 左轮手枪</option>
                            <!--for216425371432-->
                            <option value="34">.32 or 7.65mm 自动手枪</option>
                            <!--for216425371432-->
                            <option value="35">.357 Magnum 左轮手枪</option>
                            <!--for216425371432-->
                            <option value="36">.38 or 9mm 左轮手枪</option>
                            <!--for216425371432-->
                            <option value="37">.38 自动手枪</option>
                            <!--for216425371432-->
                            <option value="38">贝雷塔M9</option>
                            <!--for216425371432-->
                            <option value="39">格洛克17 9mm 自动手枪</option>
                            <!--for216425371432-->
                            <option value="40">鲁格P08</option>
                            <!--for216425371432-->
                            <option value="41">.41 左轮手枪</option>
                            <!--for216425371432-->
                            <option value="42">.44 马格南左轮手枪</option>
                            <!--for216425371432-->
                            <option value="43">.45 左轮手枪</option>
                            <!--for216425371432-->
                            <option value="44">.45 自动手枪</option>
                            <!--for216425371432-->
                            <option value="45">沙漠之鹰</option>
                            <!--for216425371432-->
                            <option value="46">.58 斯普林菲尔德步枪</option>
                            <!--for216425371432-->
                            <option value="47">.22 杠杆式枪机步枪</option>
                            <!--for216425371432-->
                            <option value="48">.30 卡宾枪</option>
                            <!--for216425371432-->
                            <option value="49">.45 马提尼·亨利步枪</option>
                            <!--for216425371432-->
                            <option value="50">莫兰上校的气动步枪</option>
                            <!--for216425371432-->
                            <option value="51">加兰德M1、M2步枪</option>
                            <!--for216425371432-->
                            <option value="52">SKS半自动步枪</option>
                            <!--for216425371432-->
                            <option value="53">.303 (7.7mm) 李恩菲尔德</option>
                            <!--for216425371432-->
                            <option value="54">.30-06 (7.62mm) 栓式枪机步枪</option>
                            <!--for216425371432-->
                            <option value="55">.30-06 (7.62mm) 半自动步枪</option>
                            <!--for216425371432-->
                            <option value="56">.444 (11.28mm) 马林步枪</option>
                            <!--for216425371432-->
                            <option value="57">猎象枪(双管)</option>
                            <!--for216425371432-->
                            <option value="58">20号霰弹枪(双管)</option>
                            <!--for216425371432-->
                            <option value="59">16号霰弹枪(双管)</option>
                            <!--for216425371432-->
                            <option value="60">12号霰弹枪(双管)</option>
                            <!--for216425371432-->
                            <option value="61">12号泵动霰弹枪</option>
                            <!--for216425371432-->
                            <option value="62">12号半自动霰弹枪</option>
                            <!--for216425371432-->
                            <option value="63">削短12号双管霰弹枪</option>
                            <!--for216425371432-->
                            <option value="64">10号霰弹枪(双管)</option>
                            <!--for216425371432-->
                            <option value="65">12号贝里尼M3 (折叠式枪托)</option>
                            <!--for216425371432-->
                            <option value="66">12号SPAS (折叠式枪托)</option>
                            <!--for216425371432-->
                            <option value="67">AK-47 or AKM</option>
                            <!--for216425371432-->
                            <option value="68">AK-74</option>
                            <!--for216425371432-->
                            <option value="69">巴雷特M82</option>
                            <!--for216425371432-->
                            <option value="70">FN FAL Light Automatic</option>
                            <!--for216425371432-->
                            <option value="71">Galil Assault Rifle</option>
                            <!--for216425371432-->
                            <option value="72">M16A2</option>
                            <!--for216425371432-->
                            <option value="73">M4</option>
                            <!--for216425371432-->
                            <option value="74">Steyr AUG</option>
                            <!--for216425371432-->
                            <option value="75">巴雷特M70/90</option>
                            <!--for216425371432-->
                            <option value="76">贝格曼MP181/ MP2811</option>
                            <!--for216425371432-->
                            <option value="77">黑克勒-科赫MP5</option>
                            <!--for216425371432-->
                            <option value="78">MAC-11</option>
                            <!--for216425371432-->
                            <option value="79">蝎式冲锋枪</option>
                            <!--for216425371432-->
                            <option value="80">汤普森冲锋枪</option>
                            <!--for216425371432-->
                            <option value="81">乌兹微型冲锋枪</option>
                            <!--for216425371432-->
                            <option value="82">M1882加特林机枪</option>
                            <!--for216425371432-->
                            <option value="83">M1918式勃朗宁自动步枪</option>
                            <!--for216425371432-->
                            <option value="84">M1917A1式勃朗宁重机枪</option>
                            <!--for216425371432-->
                            <option value="85">布伦式轻机枪</option>
                            <!--for216425371432-->
                            <option value="86">刘易斯式轻机枪</option>
                            <!--for216425371432-->
                            <option value="87">加特林机枪</option>
                            <!--for216425371432-->
                            <option value="88">FNMinimi5.56mm轻机枪</option>
                            <!--for216425371432-->
                            <option value="89">维克斯MK1式机枪</option>
                            <!--for216425371432-->
                            <option value="90">燃烧瓶</option>
                            <!--for216425371432-->
                            <option value="91">信号枪</option>
                            <!--for216425371432-->
                            <option value="92">M79 40mm榴弹发射器</option>
                            <!--for216425371432-->
                            <option value="93">炸药棒</option>
                            <!--for216425371432-->
                            <option value="94">雷管</option>
                            <!--for216425371432-->
                            <option value="95">管状炸弹</option>
                            <!--for216425371432-->
                            <option value="96">塑胶炸弹(C4)100克</option>
                            <!--for216425371432-->
                            <option value="97">手榴弹</option>
                            <!--for216425371432-->
                            <option value="98">81mm迫击炮</option>
                            <!--for216425371432-->
                            <option value="99">75mm野战炮</option>
                            <!--for216425371432-->
                            <option value="100">120mm坦克炮(稳定)</option>
                            <!--for216425371432-->
                            <option value="101">5英寸舰载炮(稳定)</option>
                            <!--for216425371432-->
                            <option value="102">反步兵地雷</option>
                            <!--for216425371432-->
                            <option value="103">阔剑地雷</option>
                            <!--for216425371432-->
                            <option value="104">火焰喷射器</option>
                            <!--for216425371432-->
                            <option value="105">轻型反坦克武器</option>
                            <!--for216425371432-->
                            <!--ms-for-end:-->
                        </select>
                    </td>
                    <td id="weaponType" class="text-center"></td>
                    <td id="weaponDamage" class="text-center"></td>
                    <td id="failRare" class="text-center"></td>
                    <td class="text-center">
                        <button onclick="weaponInfoAdd();" class="layui-btn">记录</button>
                    </td>
                </tr>

                </tbody>
            </table>
        </div>

    </fieldset>

</div>

</body>

<script>
    var value;
    var weaponName, weaponType, weaponDamage, weaponRange, weaponCt, weaponTime, weaponLoading, weaponFailRare,
        weaponYear, weaponPrice, weaponTips;

    var addWeaponList = "";

    layui.use(['laydate', 'form'], function () {
        var laydate = layui.laydate;
        var form = layui.form;

        form.on('submit(roleForm)', function (data) {
//				console.log(JSON.stringify(data.field));
            $.ajax({
                type: "put",
                url: REQUESTHEAD + "/role/createRole",
                dataType: "json",
                contentType: "application/json;charset=UTF-8",
                data: JSON.stringify(data.field),
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (data) {
                    layer.msg(data.message);
                }
            });
            return false;
        });

        //执行一个laydate实例
        laydate.render({
            elem: '#start' //指定元素
        });

        //执行一个laydate实例
        laydate.render({
            elem: '#end' //指定元素
        });
    });

    function importRoleButton() {
        //询问框
        var contentHtml = "<textarea name='importCode' style='height:400px;width:300px'></textarea>";

        layer.confirm(contentHtml, {
            btn: ['导入', '取消'] //按钮
        }, function () {

            importRole();
            layer.msg('导入完成', {
                icon: 1
            });
        }, function () {

        });

    }

    function importRole() {
        var inputText = $("textarea[name='importCode']").val();

        var baseUtils = new Base64();
        var roleStr = baseUtils.decode(inputText);
        //页面层
        loadRoleEditInfo(roleStr);

    }

    function loadRoleEditInfo(role) {
        var data = eval("(" + role + ")");
        var sexValue = data.sex;
        $("input[name='roleId']").val(data.id);
        $("input[name='createTime']").val(data.createTime);
        $("input[name='name']").val(data.name);
        $("textarea[name='weaponList']").val(data.weaponList);
        $("textarea[name='takeList']").val(data.takeList);
        $("textarea[name='assets']").val(data.assets);
        $("textarea[name='roleStory']").val(data.roleStory);
        $("textarea[name='attribute']").val(data.attribute);
        $("input[name='age']").val(data.age);
        $("input[name='times']").val(data.times);
        $("input[name='occupation']").val(data.occupation);
        $("input[name='hometown']").val(data.hometown);
        $("input[name='residence']").val(data.residence);
        $("input[name='img']").val(data.img);
//			$("textarea[name='remarks']").html(data.remarks);

        attributeTableHandle(data.attribute);

        $("img[name='img']").attr("src", data.img);

        $("input").each(function () {
            $(this).attr("value", $(this).val());
        })

        if (sexValue == 0) {
            $("#private").attr('checked', 'checked');
        }
        if (sexValue == 1) {
            $("#man").attr('checked', 'checked');
        }
        if (sexValue == 2) {
            $("#women").attr('checked', 'checked');
        }
    }


    function attributeTableHandle(attributeStr) {
        var regex = /([\u4e00-\u9fa5]+|[A-z]+)\d+/g,
            str = attributeStr;
        var attribute = str.match(regex);
        var skillControler = $("#attributeDiv");
        if (attribute != null) {
            for (var i = 0; i < attribute.length; i++) {
                htmlText = "<input name='attributeText' onchange='changeEvent(this)' class='layui-col-xs3 layui-col-sm3 layui-col-md2' value='" + attribute[i] + "'></input>";
                skillControler.append(htmlText);
            }
        }
    }

    function changeEvent(control) {
        var text = $(control).val();
        var st = '';
        $("input[name='attributeText']").each(function (index) {
            st += $(this).val();
        });
        $("textarea[name='attribute']").val(st);
    }

    function weaponListSelectChang(control) {
        value = $(control).find("option:selected").attr("value");
        weaponName = weaponData[value].name;
        weaponType = weaponData[value].success;
        weaponDamage = weaponData[value].damage;
        weaponRange = weaponData[value].range;
        weaponCt = weaponData[value].ct;
        weaponTime = weaponData[value].time;
        weaponLoading = weaponData[value].loading;
        weaponFailRare = weaponData[value].failRare;
        weaponYear = weaponData[value].year;
        weaponPrice = weaponData[value].price;
        weaponTips = "[射程：" + weaponRange + "] [穿刺：" + weaponCt + "] [次数：" + weaponTime + "] [装弹量：" + weaponLoading + "] [年代：" + weaponYear + "] [价格：" + weaponPrice + "]";

        $("#tips").attr("title", weaponTips);
        $("#weaponType").html(weaponType);
        $("#weaponDamage").html(weaponDamage);
        $("#failRare").html(weaponFailRare);
        $("#weaponName").val(weaponName);

    }

    function weaponInfoAdd() {
        var addHtmlText = "<tr title='" + weaponTips + "'> " +
            "<td>" + $("#weaponName").val() + "</td>" +
            "<td>" + weaponName + "</td>" +
            "<td>" + weaponType + "</td>" +
            "<td>" + weaponDamage + "</td>" +
            "<td>" + weaponFailRare + "</td>" +
            "</tr>";
        addWeaponList = addWeaponList + $("#weaponName").val() + " " + weaponType + " " + weaponDamage + " " + weaponFailRare + "\n";
        $("#weaponTableBody").append(addHtmlText);
//			console.log(addWeaponList);
    }
</script>

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</html>